{% extends 'base.html.twig' %}

{% block tokenDescription %}
    {% if isTokenPage and tokenDescription is defined %}
        <meta property="og:description" content="{{ tokenDescription }}">
        <meta name="description" content="{{ tokenDescription }}">
    {% else %}
        {{ parent() }}
    {% endif %}
{% endblock %}

{% block title %}
    {% if token|default %} Information about {{ token.name }} token{% else %} {{ market.base.symbol|rebranding }}/{{ market.quote.symbol|rebranding }} {% endif %} | mintMe
{% endblock %}

{% block content %}
{% set isOwner = isOwner ? 'true' : 'false' %}
{% set showAirdropCampaign = showAirdropCampaign is defined and showAirdropCampaign ? 'true' : 'false' %}
{% set userAlreadyClaimed = userAlreadyClaimed is defined and userAlreadyClaimed ? 'true' : 'false' %}
<div id="token" class="container">
    {{ include('spinners/pair.html.twig') }}
    <div class="row pt-5 justify-content-center">
        <div class="col-md-10" v-cloak>
            {{ include("loader.html.twig", {vCloak: 'v-cloak--block'}) }}
            <b-tabs no-key-nav @input="tabUpdated" :lazy="true" class="tabs-theme transparent" v-model="tabIndex">
                <token-ongoing-airdrop-campaign
                    v-if="{{ showAirdropCampaign }}"
                    :logged-in="{{ app.user ? 'true' : 'false' }}"
                    :is-owner="{{ isOwner }}"
                    :token-name="'{{ token.name | default }}'"
                    :user-already-claimed="{{ userAlreadyClaimed }}"
                    login-url="{{ absolute_url(path('fos_user_security_login')) }}"
                    signup-url="{{ absolute_url(path('fos_user_registration_register')) }}"
                ></token-ongoing-airdrop-campaign>
                {% if isTokenPage %}
                    <b-tab title="Introduction" {% if tab|default and tab == 'intro' %} {{ 'active' }} {% endif %}>
                        <div class="row">
                            <token-introduction-description
                                    class="col-12 pb-3"
                                    name="{{ token.name }}"
                                    :description="tokenDescription"
                                    :editable="{{ isOwner }}"
                                    @updated="descriptionUpdated"
                            ></token-introduction-description>
                            <token-introduction-profile
                                    class="col-12 col-lg-6 pr-lg-2"
                                    youtube-client-id="{{ global_youtube_client_id }}"
                                    profile-name="{{ profile.nickname }}"
                                    website-url="{{ token.websiteUrl }}"
                                    facebook-url="{{ token.facebookUrl }}"
                                    youtube-channel-id="{{ token.youtubeChannelId }}"
                                    :editable="{{ isOwner }}"
                                    profile-url="{{ absolute_url(path('profile-view', { 'nickname': token.getProfile().getNickname() })) }}"
                                    token-url="{{ absolute_url(path('token_show', {'name': market.quote.name, 'tab': 'intro'})) }}"
                                    :deployment-status="getTokenStatus({{ token.getDeploymentStatus | json_encode }})"
                                    token-contract-address="{{ token.address }}"
                                    token-name="{{ market.quote.name }}"
                                    telegram-url="{{ token.telegramUrl }}"
                                    discord-url="{{ token.discordUrl }}"
                                    @updated-website="websiteUpdated"
                                    @updated-facebook="facebookUpdated"
                                    @updated-youtube="youtubeUpdated"
                            >
                            </token-introduction-profile>
                            <token-introduction-statistics
                                    class="col-12 col-lg-6 pt-3 pt-lg-0 pl-lg-2"
                                    :market="{{ market | json_encode }}"
                                    :editable="{{ isOwner }}"
                                    release-period-route="{{ path('lock_in', {'name': market.quote.name}) }}"
                                    twofa="{{ app.user ? app.user.isGoogleAuthenticatorEnabled : '' }}"
                                    token-created="{{ token.getCreated().format('d M Y') }}"
                                    :precision="{{ precision }}">
                            </token-introduction-statistics>
                            <top-holders
                                    class="col-12 mt-3"
                                    :token-name="{{ market.quote.symbol | json_encode }}">
                            </top-holders>
                        </div>
                    </b-tab>
                {% endif %}
                {% if showTrade %}
                    <b-tab title="Trade" {% if tab == 'trade' %} {{ 'active' }} {% endif %}>
                        <trade
                            websocket-url="{{ global_websocket_url }}"
                            hash="{{ hash }}"
                            login-url="{{ path('fos_user_security_login') }}"
                            signup-url="{{ path('fos_user_registration_register') }}"
                            :market="{{ market | json_encode }}"
                            :logged-in="{{ app.user ? 'true' : 'false' }}"
                            :is-owner="{{ isOwner }}"
                            :precision="{{ precision }}"
                            :user-id="{{ app.user ? app.user.id : 0 }}"
                            mintme-supply-url="{{ mintme_supply }}"
                            :minimum-volume-for-marketcap="{{ minimum_volume_for_marketcap }}"
                            >
                        </trade>
                    </b-tab>
                {% endif %}
                <template slot="tabs-end">
                    {% if isTokenPage %}
                        {% if token is defined %}
                            <li class="nav-item">
                                <div class="nav-link pr-md-0">
                                    <token-deploy-icon
                                            :is-owner="{{ isOwner }}"
                                            :status-prop="getTokenStatus({{ token.getDeploymentStatus | json_encode }})"
                                            :key="reRenderView"
                                    />
                                </div>
                            </li>
                            <li class="nav-item-circle-progress">
                                <token-points-progress
                                    profile-name="{{ profile.firstName }}"
                                    profile-lastname="{{ profile.lastname  }}"
                                    profile-description="{{ profile.description }}"
                                    profile-anonymously="{{ profile.anonymous }}"
                                    :token-description="tokenDescription"
                                    :token-facebook="tokenFacebook ? tokenFacebook : {{token.facebookUrl | json_encode}}"
                                    :token-youtube="tokenYoutube ? tokenWebsite : {{token.youtubeChannelId | json_encode}}"
                                    :token-website="tokenWebsite ? tokenWebsite : {{token.websiteUrl | json_encode}}"
                                    token-status="{{ token.getDeploymentStatus }}"
                                >
                                </token-points-progress>
                            </li>
                        {% endif %}
                        <li class="nav-item-token">
                            <div class="nav-link-token">
                                <token-name
                                        :editable="{{ isOwner }}"
                                        :has-release-period-prop="{{ token.getLockIn ? 'true' : 'false' }}"
                                        :is-token-created="{{ isTokenCreated ? 'true' : 'false' }}"
                                        identifier="{{ market.quote.identifier }}"
                                        name="{{ market.quote.name }}"
                                        :precision="{{ precision }}"
                                        :status-prop="getTokenStatus({{ token.getDeploymentStatus | json_encode }})"
                                        :twofa="{{ app.user ? (app.user.isGoogleAuthenticatorEnabled ? 'true' : 'false') : 'false' }}"
                                        websocket-url="{{ global_websocket_url }}"
                                        release-address="{{ token.mintDestination }}"
                                        @token-deploy-pending="setTokenPending"
                                        @token-deployed="setTokenDeployed"
                                        :airdrop-params="{{ airdrop_params | json_encode }}"
                                        :key="reRenderView"
                                />
                            </div>
                        </li>
                    {% else %}
                        <li class="nav-item-token">
                            <div class="nav-link-token">
                                <div class="truncate-token">
                                    {% if(market.quote.name | rebranding is same as(mintme_coin)) %}
                                        <a href="{{ mintme_coin_link }}" target="_blank">
                                            <span v-b-tooltip="{title: '{{ market.quote.name | rebranding }}', boundary:'viewport'}">
                                                {{ market.quote.name | rebranding }}
                                            </span>
                                        </a>
                                    {%else%}
                                        <span v-b-tooltip="{title: '{{ market.quote.name | rebranding }}', boundary:'viewport'}">
                                            {{ market.quote.name | rebranding }}
                                        </span>
                                    {% endif %}
                                </div>
                            </div>
                        </li>
                    {% endif %}
                    <div class="clearfix"></div>
                </template>
            </b-tabs>
        </div>
        {% if token|default %}
            <input type="hidden" v-model="tokenDescription" :set-value="tokenDescription = tokenDescription || {{ token.description | json_encode }}" />
            <input type="hidden" v-model="tokenName" :set-value="tokenName = tokenName || {{ market.quote.name | json_encode }}" />
        {% endif %}
    </div>
</div>

<input type="hidden" id="confirm-website-url" value="{{ path('token_website_confirm', {'name': market.quote.name}) }}">
{% endblock %}

{% block pagescripts %}
    <script src="https://apis.google.com/js/platform.js"></script>
    <script src="https://apis.google.com/js/api.js"></script>
    <script src="{{ asset('build/pair.js') }}"></script>
    <script>
        window.fbAsyncInit = () => {
            FB.init({
                appId: '{{ global_facebook_app_id }}',
                autoLogAppEvents: true,
                xfbml: true,
                version: 'v3.1',
            });
        };
    </script>
    <script async defer src="https://connect.facebook.net/en_US/sdk.js"></script>
{% endblock %}
