{% extends 'base.html.twig' %}

{% block title %}
    {% if profile.anonymous %}
        {{ profile.nickname }}'s profile | mintMe
    {% else %}
        {{ profile.nickname }}
        {{ (profile.city is empty or not show_full_data_in_profile) ? '' : ' (from ' ~ profile.city ~ ')' }}
         profile | mintMe
    {% endif %}
{% endblock %}

{% block tokenDescription %}
    {% if profileDescription is defined and profileDescription is not empty %}
        <meta property="og:description" content="{{ profileDescription }}">
        <meta property="description" content="{{ profileDescription }}">
    {% else %}
        {{ parent() }}
    {% endif %}
{% endblock %}

{% block bodyclass %}profile-view{% endblock %}

{% block content %}
    <div id="profile" class="container">
        <div class="row pt-4 justify-content-center">
            <div class="col-12">
                <div class="card card-fixed-small mx-auto">
                    <div class="card-header">
                        <span>{{ savedNickname }} </span>
                    </div>
                    <div class="card-body position-relative">
                        {%- if (canEdit == true) -%}
                            <a @click="showEditForm = true" class="edit-icon">
                                <font-awesome-icon icon="edit" class="c-pointer ml-2 icon-default" v-if="!showEditForm"></font-awesome-icon>
                            </a>
                        {%- endif -%}
                        {%- if (profile.anonymous == true) -%}
                            <div v-if="!showEditForm">
                                This profile is private
                            </div>
                        {%- else -%}
                            <div v-if="!showEditForm" class="row mr-1">
                            <div class="col-12">
                                <div class="float-left mr-2" style="max-width: 50%;">
                                    <avatar
                                        type="profile"
                                        size="large"
                                        image="{{ profile.image.url | imagine_filter('avatar_large') }}"
                                        :editable="{{ canEdit ? 'true' : 'false' }}"
                                    ></avatar>
                                </div>
                                {% if profile.firstname is not empty %}
                                    <div class="pb-1">
                                        Full name: {{ profile.firstname() }} {{ profile.lastname() }}
                                    </div>
                                {% endif %}
                                {% if profile.country is not empty %}
                                    <div class="pb-1">
                                        Country: {{ profile.getCountryFullName() }}
                                    </div>
                                {% endif %}
                                {% if show_full_data_in_profile %}
                                    <div class="pb-1">
                                        {% if profile.city is not empty %}
                                            City: {{ profile.city }}
                                        {% endif %}
                                    </div>
                                    <div class="pb-1">
                                        {% if profile.zipCode is not empty %}
                                            ZIP code: {{ profile.zipCode }}
                                        {% endif %}
                                    </div>
                                {% endif %}
                                {% if token is not empty %}
                                    <div class="pb-1">
                                        <div>Token:</div>
                                        <a class="word-break-all" href="{{ path('token_show', {'name': token.getName()}) }}">{{ token.getName() }}</a>
                                    </div>
                                {% endif %}
                            </div>
                            <div class="col-12 pt-3">
                                <bbcode-view value="{{ profile.description }}"></bbcode-view>
                            </div>
                        </div>
                        {%- endif -%}

                        {%- if (canEdit == true) -%}
                            <div v-show="showEditForm" v-cloak>
                            {{ form_start(form) }}
                            <div class="row mb-3">
                                <div class="col-12">
                                    <div class="pb-1">
                                        {% include 'form/nickname_field.html.twig' %}
                                    </div>
                                    <div v-cloak="$v.nickname" v-if="!$v.nickname.minLength" class="text-danger text-center">
                                        Minimum length must be 2
                                    </div>
                                    <div v-cloak="$v.nickname" v-if="!$v.nickname.helpers" class="text-danger text-center">
                                        Nickname can contain only latin letters and numbers
                                    </div>
                                    <div class="pb-1">
                                        {{ form_row(form.firstName, {'attr':
                                            {
                                                'v-model.trim': '$v.firstName.$model',
                                                'v-on:keyup': 'validation',
                                                'class': 'form-control',
                                                'ref': 'firstName'
                                            }
                                        }) }}
                                    </div>
                                    <div v-cloak="$v.firstName" v-show="!$v.firstName.required" class="text-danger text-center">
                                        First Name have to be filled whether the last name is filled
                                    </div>
                                    <div v-cloak="$v.firstName" v-if="!$v.firstName.helpers" class="text-danger text-center">
                                        First name can contain only letters, ` and -
                                    </div>
                                    <div v-cloak="$v.firstName" v-if="firstNameAux" class="text-danger text-center">
                                        First name must have at least 2 letters
                                    </div>
                                    <div class="pb-1">
                                        {{ form_row(form.lastName, {'attr':
                                            {
                                                'v-model.trim': '$v.lastName.$model',
                                                'v-on:keyup': 'validation',
                                                'class': 'form-control',
                                                'ref': 'lastName'
                                            }
                                        }) }}
                                    </div>
                                    <div v-cloak="$v.lastName" v-if="!$v.lastName.required" class="text-danger text-center">
                                        Last Name have to be filled whether the first name is filled
                                    </div>
                                    <div v-cloak="$v.lastName" v-if="!$v.lastName.helpers" class="text-danger text-center">
                                        Last name can contain only letters, ` and -
                                    </div>
                                    <div v-cloak="$v.lastName" v-if="lastNameAux" class="text-danger text-center">
                                        Last name must have at least 2 letters
                                    </div>
                                    <div class="pb-1">
                                        {{ form_row(form.country, {'attr':
                                            {
                                                'ref': 'country',
                                                'v-on:change': 'countryChanged'
                                            }
                                        }) }}
                                    </div>
                                    {% if show_full_data_in_profile %}
                                        <div class="pb-1">
                                            {{ form_row(form.city, {'attr':
                                                {
                                                    'v-model.trim': '$v.city.$model',
                                                    'class': 'form-control',
                                                    'ref': 'city'
                                                }
                                            }) }}
                                        </div>
                                        <div v-cloak="$v.city" v-if="!$v.city.helpers" class="text-danger text-center">
                                            City can contain only letters, ` and -
                                        </div>
                                        <div v-cloak="$v.city" v-if="!$v.city.minLength" class="text-danger text-center">
                                            City must have at least 2 letters
                                        </div>
                                        <div class="pb-1">
                                            {{ form_row(form.zipCode, {'attr':
                                                {
                                                    'v-model.trim': '$v.zipCode.$model',
                                                    'class': 'form-control',
                                                    'ref': 'zipCode',
                                                    'v-on:input': 'zipCodeValidate',
                                                    'v-on:change': 'zipCodeValidate'
                                                }
                                            }) }}
                                        </div>
                                        <div
                                            v-if="!$v.zipCode.zipCodeContain"
                                            v-cloak="$v.zipCode"
                                            class="text-danger text-center"
                                        >
                                            Zip code can contain only letters, numbers, spaces and dashes
                                        </div>
                                        <div
                                            v-else-if="!zipCodeValid"
                                            v-cloak="$v.zipCode"
                                            class="text-danger text-center"
                                        >
                                            Zip code is not valid for selected country
                                        </div>

                                        <div
                                            v-else-if="!$v.zipCode.zipCodeWrongChars"
                                            v-cloak="$v.zipCode"
                                            class="text-danger text-center"
                                        >
                                            Zip code cannot consist only of spaces
                                        </div>
                                    {% endif %}
                                </div>
                                <div class="col-12 pt-3">
                                    <div>
                                        {{ form_row(form.description, {'attr':
                                            {
                                                'class': 'form-control form-control-md',
                                                'ref': 'description'
                                            }
                                        }) }}
                                    </div>
                                </div>
                                <div class="col-12 pt-3">
                                    <div class="custom-control custom-checkbox">
                                        {{ form_widget(form.anonymous) }}
                                        {{ form_label(form.anonymous) }}
                                        <guide>
                                            <template slot="header">
                                                Private profile
                                            </template>
                                            <template slot="body">
                                                If you turn this on, no one will be able to see your personal data
                                                when visiting your profile, only your nickname.
                                            </template>
                                        </guide>
                                    </div>
                                </div>
                            </div>
                            <div class="text-left">
                                <input
                                    type="submit"
                                    :disabled="disableSave"
                                    class="btn btn-primary"
                                    value="Save">
                                <a href="{{ path('profile') }}" @click="showEditForm = false" class="btn-cancel pl-3" >Cancel</a>
                            </div>
                            {{ form_end(form) }}
                        </div>
                        {%- endif -%}
                    </div>
                    <input type="hidden" ref="editFormShowFirst" value="{{ editFormShowFirst }}"/>
                </div>
            </div>
        </div>
    </div>
{% endblock %}

{% block pagescripts %}
    <script src="{{ asset('build/profile.js') }}"></script>
{% endblock %}
