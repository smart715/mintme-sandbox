# This file is a template, and might need editing before it works on your project.
# see https://docs.gitlab.com/ce/ci/yaml/README.html for all available options

# *********************
# ATENTION: PLEASE, DON'T EDIT THIS FILE IF YOU ARE NOT AN ADMIN!!
# IF YOU HAVE ANY DOUBT, PLEASE CONTACT TO ANY SYSADMIN..
# *********************

stages:
  - build-sites
  - clean-unused-sites

before_script:
  - shopt -s expand_aliases
  - alias php='/usr/bin/php7.2'
  - alias npm='/usr/local/bin/npm'

build_mintme_sites:
  stage: build-sites
  script:
    - SRC=$(pwd)
    - sudo build-sites-mintme-sandbox.sh -a build -b $CI_COMMIT_REF_NAME -s $SRC
  cache:
    key: "$CI_COMMIT_REF_SLUG"
    paths:
      - node_modules/
      - vendor/
  tags:
    # This job only will be executed by this runner:
    - mintme.abchosting.org
  only:
    # this job only will be executed for branches
    - branches

clean_mintme_unused_sites:
  stage: clean-unused-sites
  script:
    - sudo /usr/local/bin/clean-unused-sites-mintme-sandbox.py
  tags:
    # This job only will be executed by this runner:
    - mintme.abchosting.org
  only:
    # this job only will be executed for branches named
    # master
    - branches
  allow_failure: true

