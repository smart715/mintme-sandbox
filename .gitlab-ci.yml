# This file is a template, and might need editing before it works on your project.
# see https://docs.gitlab.com/ce/ci/yaml/README.html for all available options

# *********************
# ATENTION: PLEASE, DON'T EDIT THIS FILE IF YOU ARE NOT AN ADMIN!!
# IF YOU HAVE ANY DOUBT, PLEASE CONTACT TO ANY SYSADMIN..
# *********************

stages:
  - update-repository
  - tests

update_repository_redmine_training.abchosting.org:
  script:
    - cd /home/git/gitlab/mintme-panel.git && sudo git fetch --all -p
  stage: update-repository
  tags:
    # this job will be executed only on training.abchosting.org server
    - training.abchosting.org

before_script:
  - shopt -s expand_aliases
  - alias php='/usr/bin/php7.2'
  - alias npm='/usr/local/bin/npm'

tests_php:
  stage: tests
  script:
    - export $(grep -v '^#' .env.dist | xargs)
    - composer install
    - make phpunit
    - make syntax_check
  tags:
    - mintme.abchosting.org

tests_assets:
  stage: tests
  script:
    - npm install
    - make syntax_check_assets
    - make karma
  tags:
    - mintme.abchosting.org